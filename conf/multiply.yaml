defaults:
    - base
    - _self_
finetune:
    seq_length: 4000
    gradient_accumulation_passes: 1024
    save_checkpoint_steps: 1000
    max_train_steps: 0  # Keep at 1 to ensure version 0 is created
llm:
    parameters:
        max_tokens: 500
test_llm:
    parameters:
        max_tokens: 500
vllm_config:
    vllm_kwargs:
        max_model_len: 4000  # Match seq_length for multiply task
actor:
  rollout_policy: pipelinerl.domains.puzzle.multiply.generate_multiply_rollout
  system_prompt: null
  task_template: |-
    import re

    def multiply_game(response: str) -> float:
        """this defines the environment for the multiply game and returns the reward [0, 1]"""

        a = {a}
        b = {b}
        try:
            expression = int(re.search(r'<answer>(.*?)</answer>', response).group(1))
        except Exception:
            return 0
        
        if expression == a * b:
            return 1
        else:
            return 0.1
  reward_function: multiply_game


environment: null

dataset_loader: pipelinerl.domains.puzzle.multiply.load_multiply_problems
train_dataset_names:
  - train
test_dataset_names:
  - test

world:
  actor_fraction: 1    # 1 GPU for vLLM inference (sampling)
  preprocessor_fraction: 0
  finetune_fraction: 1  # 1 GPU for training

eval_every_n_versions: 1  # Set to 0 to trigger evaluation immediately (at version 0)
model_path: Qwen/Qwen2.5-0.5B-Instruct

wandb:
  use_wandb: true
  wandb_id: null
  wandb_name: null
  # W&B entity name
  wandb_entity_name: null
  # W&B project name
  wandb_project_name: pipeline-rl-multiply
  # W&B resume policy
  wandb_resume: always
  # Whether to use only the basename or the full path as the run name
  wandb_use_basename: True
  wandb_workspace_root: null
  # set the group in your config
  wandb_group: null
  wandb_dir: null
  # Comma-separated list of keywords to tag the run.
  tags: []
